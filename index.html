<!DOCTYPE html>
<html lang="uk">

<head>
    <meta name="mobile-web-app-capable" content="yes">

    <meta name="apple-mobile-web-app-capable" content="yes">

    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="theme-color" content="#2196F3">
</head>

<body>
    <header>
        <h1>–ü—Ä–∏–≤—ñ—Ç, PWA! üëã</h1>
    </header>
    <main>
        <p>–¶–µ –ø—Ä–æ—Å—Ç–∏–π –ü—Ä–æ–≥—Ä–µ—Å–∏–≤–Ω–∏–π –í–µ–±-–î–æ–¥–∞—Ç–æ–∫.</p>

        <button id="installButton" style="display: none;">
            –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ —è–∫ –¥–æ–¥–∞—Ç–æ–∫
        </button>

        <div id="status">–°—Ç–∞—Ç—É—Å: –û–Ω–ª–∞–π–Ω</div>
    </main>

    <script>
        let deferredInstallPrompt = null;
        const installButton = document.getElementById('installButton');

        // 1. –û–±—Ä–æ–±–∫–∞ –ø–æ–¥—ñ—ó beforeinstallprompt
        window.addEventListener('beforeinstallprompt', (e) => {
            // –ó–∞–ø–æ–±—ñ–≥–∞—î–º–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–º—É –ø–æ–∫–∞–∑—É —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –±–∞–Ω–µ—Ä–∞
            e.preventDefault();

            // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –ø–æ–¥—ñ—é, —â–æ–± –≤–∏–∫–ª–∏–∫–∞—Ç–∏ —ó—ó –ø—ñ–∑–Ω—ñ—à–µ –ø—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ –∫–Ω–æ–ø–∫–∏
            deferredInstallPrompt = e;

            // –ü–æ–∫–∞–∑—É—î–º–æ –Ω–∞—à—É –∫–∞—Å—Ç–æ–º–Ω—É –∫–Ω–æ–ø–∫—É
            installButton.style.display = 'block';
            console.log('–ü–æ–¥—ñ—è beforeinstallprompt –∑–±–µ—Ä–µ–∂–µ–Ω–∞. –ö–Ω–æ–ø–∫–∞ –ø–æ–∫–∞–∑–∞–Ω–∞.');
        });

        // 2. –û–±—Ä–æ–±–∫–∞ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—è –∫–Ω–æ–ø–∫–∏
        installButton.addEventListener('click', async () => {
            if (!deferredInstallPrompt) {
                console.log('–ü–æ–¥—ñ—è –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –Ω–µ –¥–æ—Å—Ç—É–ø–Ω–∞.');
                return;
            }

            // –í–∏–∫–ª–∏–∫–∞—î–º–æ –∑–±–µ—Ä–µ–∂–µ–Ω—É –ø–æ–¥—ñ—é, —â–æ–± –ø–æ–∫–∞–∑–∞—Ç–∏ —Å–∏—Å—Ç–µ–º–Ω–µ –¥—ñ–∞–ª–æ–≥–æ–≤–µ –≤—ñ–∫–Ω–æ
            deferredInstallPrompt.prompt();

            // –ß–µ–∫–∞—î–º–æ –Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
            const { outcome } = await deferredInstallPrompt.userChoice;
            console.log(`–í–∏–±—ñ—Ä –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞: ${outcome}`);

            // –ü—ñ—Å–ª—è —Ç–æ–≥–æ, —è–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –∑—Ä–æ–±–∏–≤ –≤–∏–±—ñ—Ä, –ø—Ä–∏—Ö–æ–≤—É—î–º–æ –∫–Ω–æ–ø–∫—É
            deferredInstallPrompt = null;
            installButton.style.display = 'none';

            if (outcome === 'accepted') {
                console.log('–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –ø—Ä–∏–π–Ω—è–≤ –∑–∞–ø–∏—Ç –Ω–∞ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è.');
            } else {
                console.log('–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤—ñ–¥—Ö–∏–ª–∏–≤ –∑–∞–ø–∏—Ç –Ω–∞ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è.');
            }
        });


        // –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è Service Worker (—Å—Ç–∞—Ä–∏–π –∫–æ–¥)
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('Service Worker –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω–æ —É—Å–ø—ñ—à–Ω–æ:', registration);
                    })
                    .catch(error => {
                        console.log('–ü–æ–º–∏–ª–∫–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó Service Worker:', error);
                    });
            });
        }

        // –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞—Ç—É—Å—É –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è (—Å—Ç–∞—Ä–∏–π –∫–æ–¥)
        function updateStatus() {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = navigator.onLine ? '–°—Ç–∞—Ç—É—Å: –û–Ω–ª–∞–π–Ω' : '–°—Ç–∞—Ç—É—Å: –û—Ñ–ª–∞–π–Ω (–∑ –∫–µ—à—É)';
            statusDiv.className = navigator.onLine ? 'online' : 'offline';
        }
        window.addEventListener('online', updateStatus);
        window.addEventListener('offline', updateStatus);
        updateStatus();
    </script>
</body>

</html>